<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TapQuest â€“ Reinos de TON</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

<style>
body{
  margin:0;
  background:radial-gradient(circle at top,#1b2a4a,#05070d);
  font-family:system-ui,sans-serif;
  color:#fff;
  text-align:center;
}
.container{max-width:420px;margin:auto;padding:14px}
h1{margin:6px 0}

.top{display:flex;justify-content:space-between;font-size:14px}

.bar{height:14px;background:#222;border-radius:10px;overflow:hidden;margin:6px 0}
.fill{height:100%;transition:.3s}
.energy{background:linear-gradient(90deg,#00ff87,#60efff)}
.xp{background:linear-gradient(90deg,#ff512f,#dd2476)}

.enemy{
  margin:20px auto;
  width:180px;height:180px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:26px;
  background:radial-gradient(circle,#4caf50,#1b5e20);
  box-shadow:0 0 30px #2aff8a;
  transition:.1s;
  position:relative;
}

.enemy.hit{animation:shake .15s}
.enemy.crit{box-shadow:0 0 60px gold}

@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  100%{transform:translateX(0)}
}

button{
  width:100%;padding:14px;margin-top:8px;
  font-size:18px;border:none;border-radius:14px;
  font-weight:bold;color:#fff;
}

.tap{background:linear-gradient(180deg,#00f260,#0575e6)}
.menu{background:linear-gradient(180deg,#ff9800,#f44336)}
.wallet{background:linear-gradient(180deg,#0098ea,#005bbb)}
.shop-btn{background:linear-gradient(180deg,#8e2de2,#4a00e0)}

.float{
  position:absolute;
  font-weight:bold;
  animation:floatUp 1s forwards;
  pointer-events:none;
}

@keyframes floatUp{
  from{opacity:1;transform:translateY(0)}
  to{opacity:0;transform:translateY(-40px)}
}

.panel{
  background:#0e1628;
  border-radius:16px;
  padding:12px;
  margin-top:10px;
  display:none;
}

.show{display:block}

.nft{
  background:#1c2541;
  padding:10px;
  border-radius:12px;
  margin-top:6px;
}
</style>
</head>

<body>
<div class="container">
<h1>âš”ï¸ TapQuest</h1>

<div class="top">
  <div>ğŸª™ <span id="gold">0</span></div>
  <div id="walletStatus">ğŸ”Œ No wallet</div>
</div>

<div class="bar"><div id="energyBar" class="fill energy"></div></div>
<div class="bar"><div id="xpBar" class="fill xp"></div></div>

<div id="enemy" class="enemy">ğŸŒ³</div>

<button class="tap" onclick="tap()">TAP ATACAR</button>
<button class="wallet" id="connectBtn">ğŸ”— Conectar Wallet TON</button>
<button class="menu" onclick="togglePanel('nfts')">ğŸ–¼ NFTs</button>

<div id="nfts" class="panel">
  <h3>Mis NFTs</h3>
  <div id="nftList"></div>
</div>

</div>

<script>
Telegram.WebApp.ready();

/* ---------- TON CONNECT ---------- */
const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl: 'https://raw.githubusercontent.com/ton-connect/demo-dapp/main/manifest.json'
});

const connectBtn = document.getElementById("connectBtn");
const walletStatus = document.getElementById("walletStatus");

connectBtn.onclick = async ()=>{
  await tonConnectUI.connectWallet();
};

tonConnectUI.onStatusChange(wallet=>{
  if(wallet){
    walletStatus.textContent = "ğŸŸ¢ Wallet conectada";
    connectBtn.style.display="none";
    save();
  }
});

/* ---------- GAME DATA ---------- */
let data = JSON.parse(localStorage.getItem("tapquest")) || {
  energy:100,
  xp:0,
  gold:0,
  damage:1,
  nfts:[]
};

const nftPool = [
  {name:"Espada del Bosque",rare:"ComÃºn"},
  {name:"Amuleto del Desierto",rare:"Raro"},
  {name:"CorazÃ³n del VolcÃ¡n",rare:"Ã‰pico"}
];

function save(){
  localStorage.setItem("tapquest",JSON.stringify(data));
}

function updateUI(){
  energyBar.style.width=data.energy+"%";
  xpBar.style.width=data.xp+"%";
  gold.textContent=data.gold;
  enemy.textContent="ğŸŒ³";
  renderNFTs();
}

function tap(){
  if(data.energy<=0)return;
  data.energy--;

  let crit=Math.random()<0.15;
  let dmg=(crit?10:5)+data.damage;
  data.xp+=dmg;

  hitEffect(dmg,crit);

  if(data.xp>=100){
    data.xp=0;
    data.energy=100;
    data.gold+=5;

    if(Math.random()<0.25){
      let nft=nftPool[Math.floor(Math.random()*nftPool.length)];
      data.nfts.push(nft);
    }
  }

  save();updateUI();
}

function hitEffect(dmg,crit){
  enemy.classList.add("hit");
  if(crit)enemy.classList.add("crit");
  setTimeout(()=>enemy.classList.remove("hit","crit"),150);

  let f=document.createElement("div");
  f.className="float";
  f.style.left="50%";
  f.style.top="50%";
  f.style.color=crit?"gold":"#ff5252";
  f.textContent="-"+dmg;
  enemy.appendChild(f);
  setTimeout(()=>f.remove(),1000);

  if(navigator.vibrate)navigator.vibrate(crit?[30,20,30]:20);
}

function togglePanel(id){
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("show"));
  document.getElementById(id).classList.add("show");
}

function renderNFTs(){
  nftList.innerHTML="";
  if(data.nfts.length===0){
    nftList.innerHTML="<p>No tienes NFTs aÃºn</p>";
    return;
  }
  data.nfts.forEach(n=>{
    let d=document.createElement("div");
    d.className="nft";
    d.textContent=`ğŸ–¼ ${n.name} (${n.rare})`;
    nftList.appendChild(d);
  });
}

updateUI();
</script>
</body>
</html>eferrals()">ğŸ¤ Referidos</button>
</div>

<div class="card hidden" id="zone">
  <h2 id="enemyName"></h2>
  <p>ğŸ‘¹ HP <span id="enemy">0</span></p>
  <div class="bar"><div id="energyBar" class="fill energy"></div></div>
  <div class="bar"><div id="xpBar" class="fill xp"></div></div>
  <p>ğŸª™ Oro <span id="gold">0</span> | ğŸ’ TapCoin <span id="tapcoin">0</span></p>
  <button class="tap" onclick="tap()">âš”ï¸ ATACAR</button>
  <button class="back" onclick="back()">â¬…ï¸ Volver</button>
</div>

<div class="card hidden" id="missions">
  <h2>ğŸ“… Misiones Diarias</h2>
  <p id="m1"></p>
  <p id="m2"></p>
  <p id="m3"></p>
  <button class="back" onclick="closeMissions()">â¬…ï¸ Volver</button>
</div>

<div class="card hidden" id="referrals">
  <h2>ğŸ¤ Referidos</h2>
  <p>Tu cÃ³digo:</p>
  <b id="refCode"></b>
  <p>Comparte este link:</p>
  <small id="refLink"></small>
  <p>ğŸ’ Bonus ganado: <span id="refBonus">0</span></p>
  <button class="back" onclick="closeReferrals()">â¬…ï¸ Volver</button>
</div>

<audio id="hit" src="https://actions.google.com/sounds/v1/impacts/wood_plank_flicks.ogg"></audio>
<audio id="crit" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

<script>
// ===== TON =====
const tonConnectUI=new TON_CONNECT_UI.TonConnectUI({
 manifestUrl:'https://raw.githubusercontent.com/ton-connect/demo-dapp/main/public/tonconnect-manifest.json'
});
async function connectWallet(){
 const w=await tonConnectUI.connectWallet();
 wallet.innerText="Wallet: "+w.account.address.slice(0,6)+"..."+w.account.address.slice(-4);
}

// ===== ARMAS =====
const weapons=[
 {name:"Espada ComÃºn",dmg:1,crit:0},
 {name:"Espada Rara",dmg:2,crit:.05},
 {name:"Espada Ã‰pica",dmg:4,crit:.1},
 {name:"Espada Legendaria",dmg:7,crit:.2}
];
let weapon=weapons[0];

// ===== ENEMIGOS =====
const enemies=[
 {name:"Slime",hp:5,atk:1,boss:false},
 {name:"Goblin",hp:8,atk:2,boss:false},
 {name:"Orco",hp:12,atk:3,boss:false},
 {name:"ğŸ‘‘ DragÃ³n",hp:40,atk:6,boss:true}
];

// ===== ESTADO =====
let gold=0,tapCoin=0,energy=100,xp=0,level=1;
let enemyHP=0,enemyObj;

// ===== MISIONES =====
let missions={
 taps:{goal:50,progress:0,reward:5},
 kills:{goal:10,progress:0,reward:10},
 coins:{goal:10,progress:0,reward:10},
 lastReset:Date.now()
};

// ===== REFERIDOS =====
let refCode="TQ-"+Math.random().toString(36).substring(2,8).toUpperCase();
let refBonus=0;

// ===== MAPA =====
function enterZone(){
 map.classList.add("hidden");
 zone.classList.remove("hidden");
 spawnEnemy();
 updateUI();
}
function back(){
 zone.classList.add("hidden");
 map.classList.remove("hidden");
}

// ===== COMBATE =====
function tap(){
 if(energy<=0)return;
 energy--; missions.taps.progress++;

 let critChance=.2+weapon.crit;
 let critHit=Math.random()<critChance;
 let dmg=weapon.dmg+(critHit?weapon.dmg:0);

 enemyHP-=dmg;
 tapCoin++; missions.coins.progress++;

 play(critHit?"crit":"hit");
 vibrate(dmg);
 effects(dmg,critHit);

 if(enemyHP<=0){
  gold+=2; xp+=5;
  missions.kills.progress++;
  if(Math.random()<.15)weapon=weapons[Math.floor(Math.random()*weapons.length)];
  spawnEnemy();
 }
 updateUI();
}

// ===== EFECTOS =====
function effects(dmg,crit){
 zone.classList.remove("hit","crit");void zone.offsetWidth;
 zone.classList.add("hit"); if(crit)zone.classList.add("crit");

 for(let i=0;i<8;i++){
  let p=document.createElement("div");
  p.className="particle";p.style.background=crit?"gold":"white";
  p.style.left="50%";p.style.top="45%";
  p.style.setProperty("--x",(Math.random()*80-40)+"px");
  p.style.setProperty("--y",(Math.random()*-80)+"px");
  document.body.appendChild(p);setTimeout(()=>p.remove(),600);
 }
 let d=document.createElement("div");
 d.className="damage";d.style.color=crit?"gold":"white";
 d.style.left="50%";d.style.top="40%";
 d.innerText=crit?"CRIT "+dmg:dmg;
 document.body.appendChild(d);setTimeout(()=>d.remove(),800);
}

// ===== ENEMIGOS =====
function spawnEnemy(){
 enemyObj=Math.random()>.9?enemies[3]:enemies[Math.floor(Math.random()*3)];
 enemyHP=enemyObj.hp; enemyName.innerText=enemyObj.name;
}

// ===== MISIONES UI =====
function openMissions(){
 map.classList.add("hidden");missionsDiv.classList.remove("hidden");
 m1.innerText=`âš”ï¸ Toca ${missions.taps.goal} veces (${missions.taps.progress})`;
 m2.innerText=`ğŸ‘¹ Derrota ${missions.kills.goal} enemigos (${missions.kills.progress})`;
 m3.innerText=`ğŸ’ Gana ${missions.coins.goal} TapCoin (${missions.coins.progress})`;
}
function closeMissions(){
 missionsDiv.classList.add("hidden");map.classList.remove("hidden");
}

// ===== REFERIDOS UI =====
function openReferrals(){
 map.classList.add("hidden");referrals.classList.remove("hidden");
 refCodeSpan.innerText=refCode;
 refLink.innerText="https://t.me/TUBOT?start="+refCode;
 refBonusSpan.innerText=refBonus;
}
function closeReferrals(){
 referrals.classList.add("hidden");map.classList.remove("hidden");
}

// ===== UTIL =====
function play(id){let s=document.getElementById(id);s.currentTime=0;s.play()}
function vibrate(p){
 if(Telegram?.WebApp?.HapticFeedback)
  Telegram.WebApp.HapticFeedback.impactOccurred(p>3?"heavy":"light");
 else navigator.vibrate(30+p*10);
}

// ===== UI =====
function updateUI(){
 enemy.innerText=enemyHP; gold.innerText=gold;
 tapcoin.innerText=tapCoin; energyBar.style.width=energy+"%";
 xpBar.style.width=Math.min((xp/(level*30))*100,100)+"%";
 weaponName.innerText=weapon.name;
}

// ===== IDLE =====
setInterval(()=>{if(energy<100){energy++;updateUI()}},5000);

// ===== TELEGRAM =====
if(window.Telegram){Telegram.WebApp.ready();Telegram.WebApp.expand()}
</script>

</body>
</html>  background:linear-gradient(180deg,#f5af19,#f12711);
  color:#000;
  font-weight:bold;
}
button:active{transform:scale(.96)}
.tap{font-size:24px;background:linear-gradient(180deg,#00f260,#0575e6);color:#fff}
.back{background:linear-gradient(180deg,#434343,#000);color:#fff}
.hidden{display:none}

.bar{width:100%;height:16px;background:#222;border-radius:10px;overflow:hidden;margin-bottom:12px}
.fill{height:100%;transition:width .25s}
.energy{background:linear-gradient(90deg,#00ff87,#60efff)}
.xp{background:linear-gradient(90deg,#ff512f,#dd2476)}

/* ==== EFECTO SUAVE ==== */
.hit{
  animation:softHit .18s ease-out;
}
@keyframes softHit{
  0%{transform:scale(1);box-shadow:0 0 0 rgba(255,255,255,0)}
  40%{transform:scale(1.02);box-shadow:0 0 20px rgba(255,255,255,.35)}
  100%{transform:scale(1);box-shadow:0 0 0 rgba(255,255,255,0)}
}

/* ==== CRÃTICO ==== */
.crit{
  box-shadow:0 0 30px rgba(255,215,0,.9)!important;
}

/* ==== PARTÃCULAS ==== */
.particle{
  position:absolute;
  width:6px;
  height:6px;
  border-radius:50%;
  pointer-events:none;
  animation:particle .6s ease-out forwards;
}
@keyframes particle{
  from{opacity:1;transform:translate(0,0) scale(1)}
  to{opacity:0;transform:translate(var(--x),var(--y)) scale(.2)}
}

/* ==== DAÃ‘O FLOTANTE ==== */
.damage{
  position:absolute;
  font-weight:bold;
  animation:float .8s ease-out forwards;
  pointer-events:none;
}
@keyframes float{
  from{opacity:1;transform:translateY(0)}
  to{opacity:0;transform:translateY(-40px)}
}
</style>
</head>

<body>

<h1>âš”ï¸ TapQuest</h1>

<div class="card" id="map">
  <button onclick="connectWallet()">ğŸ”— Conectar Wallet TON</button>
  <p id="walletAddress">Wallet: no conectada</p>
  <p>ğŸ§¬ Nivel: <span id="level">1</span> | â­ XP: <span id="xp">0</span></p>
  <button onclick="enterZone(1)">ğŸŒ² Bosque</button>
</div>

<div class="card hidden" id="zone">
  <h2 id="zoneName"></h2>
  <p>ğŸª™ Oro: <span id="gold">0</span> | ğŸ’ TapCoin: <span id="tapcoin">0</span></p>

  <div class="bar"><div id="energyBar" class="fill energy"></div></div>
  <div class="bar"><div id="xpBar" class="fill xp"></div></div>

  <p>ğŸ‘¹ HP: <span id="enemy">0</span></p>

  <button class="tap" onclick="tap()">âš”ï¸ ATACAR</button>
  <button class="back" onclick="back()">â¬…ï¸ Volver</button>
</div>

<audio id="sndHit" src="https://actions.google.com/sounds/v1/impacts/wood_plank_flicks.ogg"></audio>
<audio id="sndCrit" src="https://actions.google.com/sounds/v1/cartoon/metal_twang.ogg"></audio>

<script>
/* ==== TON ==== */
const tonConnectUI=new TON_CONNECT_UI.TonConnectUI({
 manifestUrl:'https://raw.githubusercontent.com/ton-connect/demo-dapp/main/public/tonconnect-manifest.json'
});
async function connectWallet(){
 const w=await tonConnectUI.connectWallet();
 walletAddress.innerText="Wallet: "+w.account.address.slice(0,6)+"..."+w.account.address.slice(-4);
}

/* ==== UTIL ==== */
function play(id){const s=document.getElementById(id);if(s){s.currentTime=0;s.play()}}
function vibratePower(dmg){
 let ms=Math.min(20+dmg*10,120);
 if(Telegram?.WebApp?.HapticFeedback)
  Telegram.WebApp.HapticFeedback.impactOccurred(dmg>3?"heavy":"light");
 else navigator.vibrate(ms);
}

/* ==== ESTADO ==== */
let gold=0,tapCoin=0,energy=100,level=1,xp=0,damage=1;
let enemyHP=5;

/* ==== MAPA ==== */
function enterZone(){
 map.classList.add("hidden");
 zone.classList.remove("hidden");
 zoneName.innerText="ğŸŒ² Bosque Inicial";
 enemyHP=5;
 updateUI();
}
function back(){
 zone.classList.add("hidden");
 map.classList.remove("hidden");
}

/* ==== COMBATE PREMIUM ==== */
function tap(){
 if(energy<=0)return;
 energy--;

 let crit=Math.random()<0.2;
 let dmg=crit?damage*2:damage;

 enemyHP-=dmg;
 tapCoin++;

 play(crit?"sndCrit":"sndHit");
 vibratePower(dmg);

 softHit(crit);
 spawnParticles(crit);
 showDamage(dmg,crit);

 if(enemyHP<=0){
  enemyHP=5;
  gold+=2;
  xp+=5;
 }
 updateUI();
}

/* ==== EFECTOS ==== */
function softHit(crit){
 zone.classList.remove("hit","crit");
 void zone.offsetWidth;
 zone.classList.add("hit");
 if(crit)zone.classList.add("crit");
}
function spawnParticles(crit){
 for(let i=0;i<8;i++){
  let p=document.createElement("div");
  p.className="particle";
  p.style.background=crit?"gold":"white";
  p.style.left=window.innerWidth/2+"px";
  p.style.top="50%";
  p.style.setProperty("--x",(Math.random()*80-40)+"px");
  p.style.setProperty("--y",(Math.random()*-80)+"px");
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),600);
 }
}
function showDamage(val,crit){
 let d=document.createElement("div");
 d.className="damage";
 d.style.color=crit?"gold":"white";
 d.style.left=window.innerWidth/2+"px";
 d.style.top="45%";
 d.innerText=crit?"CRIT "+val:val;
 document.body.appendChild(d);
 setTimeout(()=>d.remove(),800);
}

/* ==== UI ==== */
function updateUI(){
 gold.innerText=gold;
 tapcoin.innerText=tapCoin;
 enemy.innerText=enemyHP;
 energyBar.style.width=energy+"%";
 xpBar.style.width=Math.min((xp/30)*100,100)+"%";
}

/* ==== IDLE ==== */
setInterval(()=>{if(energy<100){energy++;updateUI()}},5000);

/* ==== TELEGRAM ==== */
if(window.Telegram){Telegram.WebApp.ready();Telegram.WebApp.expand()}
</script>

</body>
</html>  border:none;
  cursor:pointer;
  background:linear-gradient(180deg,#f5af19,#f12711);
  color:#000;
  font-weight:bold;
}
button:active{transform:scale(.95)}
button:disabled{background:#555;color:#aaa}
.tap{font-size:24px;background:linear-gradient(180deg,#00f260,#0575e6);color:#fff}
.back{background:linear-gradient(180deg,#434343,#000);color:#fff}
.hidden{display:none}

.bar{width:100%;height:16px;background:#222;border-radius:10px;overflow:hidden;margin-bottom:12px}
.fill{height:100%;transition:width .3s}
.energy{background:linear-gradient(90deg,#00ff87,#60efff)}
.xp{background:linear-gradient(90deg,#ff512f,#dd2476)}
.hit{animation:hit .15s}
@keyframes hit{
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  100%{transform:translateX(0)}
}
</style>
</head>

<body>

<h1>âš”ï¸ TapQuest</h1>

<!-- MAPA -->
<div class="card" id="map">
  <h2>ğŸ—ºï¸ Mapa del Mundo</h2>

  <button onclick="connectWallet()">ğŸ”— Conectar Wallet TON</button>
  <p id="walletAddress">Wallet: no conectada</p>

  <p>ğŸ§¬ Nivel: <span id="level">1</span></p>
  <p>â­ XP: <span id="xp">0</span></p>

  <button onclick="enterZone(1)">ğŸŒ² Bosque Inicial</button>
  <button id="zone2" onclick="enterZone(2)" disabled>ğŸœï¸ Desierto (Nivel 3)</button>
  <button id="zone3" onclick="enterZone(3)" disabled>ğŸ”ï¸ MontaÃ±as (Nivel 5)</button>
</div>

<!-- ZONA -->
<div class="card hidden" id="zone">
  <h2 id="zoneName"></h2>

  <p>ğŸª™ Oro: <span id="gold">0</span></p>
  <p>ğŸ’ TapCoin: <span id="tapcoin">0</span></p>

  <p>ğŸ”‹ EnergÃ­a</p>
  <div class="bar"><div id="energyBar" class="fill energy"></div></div>

  <p>â­ XP</p>
  <div class="bar"><div id="xpBar" class="fill xp"></div></div>

  <p>ğŸ‘¹ Enemigo HP: <span id="enemy">0</span></p>

  <button class="tap" onclick="tap()">âš”ï¸ ATACAR</button>
  <button onclick="openInventory()">ğŸ’ Inventario</button>
  <button onclick="requestWithdraw()">ğŸ’¸ Solicitar Retiro</button>
  <button class="back" onclick="back()">â¬…ï¸ Volver</button>
</div>

<!-- INVENTARIO -->
<div class="card hidden" id="inventory">
  <h2>ğŸ’ Inventario</h2>
  <p>ğŸ—¡ï¸ Espadas: <span id="swords">0</span></p>
  <button onclick="useSword()">Usar espada</button>
  <p>ğŸ§ª Pociones: <span id="potions">0</span></p>
  <button onclick="usePotion()">Usar pociÃ³n</button>
  <button class="back" onclick="closeInventory()">â¬…ï¸ Volver</button>
</div>

<!-- SONIDOS -->
<audio id="sndHit" src="https://actions.google.com/sounds/v1/impacts/wood_plank_flicks.ogg"></audio>
<audio id="sndLevel" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="sndItem" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>

<script>
// ===== TON CONNECT =====
const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl:'https://raw.githubusercontent.com/ton-connect/demo-dapp/main/public/tonconnect-manifest.json'
});
async function connectWallet(){
  const w = await tonConnectUI.connectWallet();
  document.getElementById("walletAddress").innerText =
    "Wallet: " + w.account.address.slice(0,6)+"..."+w.account.address.slice(-4);
}

// ===== UTIL =====
function playSound(id){const s=document.getElementById(id);if(s){s.currentTime=0;s.play()}}
function vibrate(ms=30){
  if(window.Telegram && Telegram.WebApp.HapticFeedback){
    Telegram.WebApp.HapticFeedback.impactOccurred("light");
  } else if(navigator.vibrate){navigator.vibrate(ms)}
}

// ===== ESTADO =====
let gold=0, tapCoin=0, energy=100, level=1, xp=0, damage=1;
let inventory={swords:0,potions:0};

const zones={
  1:{name:"ğŸŒ² Bosque Inicial",hp:5,xp:5,gold:2},
  2:{name:"ğŸœï¸ Desierto Antiguo",hp:10,xp:10,gold:4},
  3:{name:"ğŸ”ï¸ MontaÃ±as Heladas",hp:20,xp:20,gold:8}
};
let currentZone=1, enemyHP=zones[1].hp;

// ===== MAPA =====
function enterZone(z){
  currentZone=z; enemyHP=zones[z].hp;
  document.getElementById("map").classList.add("hidden");
  document.getElementById("zone").classList.remove("hidden");
  document.getElementById("zoneName").innerText=zones[z].name;
  updateUI();
}
function back(){
  document.getElementById("zone").classList.add("hidden");
  document.getElementById("map").classList.remove("hidden");
}

// ===== COMBATE =====
function tap(){
  if(energy<=0)return;
  playSound("sndHit"); vibrate(20);
  energy--; enemyHP-=damage;
  if(enemyHP<=0){
    enemyHP=zones[currentZone].hp;
    gold+=zones[currentZone].gold;
    xp+=zones[currentZone].xp;
    tapCoin+=1;
    if(Math.random()<0.3)inventory.potions++;
    if(Math.random()<0.2)inventory.swords++;
    checkLevelUp();
  }
  updateUI();
}

// ===== NIVEL =====
function checkLevelUp(){
  let need=level*30;
  if(xp>=need){
    xp-=need; level++;
    playSound("sndLevel"); vibrate(60);
    alert("ğŸ§¬ Subiste a nivel "+level);
    if(level>=3)zone2.disabled=false;
    if(level>=5)zone3.disabled=false;
  }
}

// ===== INVENTARIO =====
function openInventory(){
  zone.classList.add("hidden");
  inventoryDiv.classList.remove("hidden");
  updateInventory();
}
function closeInventory(){
  inventoryDiv.classList.add("hidden");
  zone.classList.remove("hidden");
}
function useSword(){
  if(inventory.swords<=0)return;
  playSound("sndItem"); vibrate(40);
  inventory.swords--; damage++;
  updateInventory();
}
function usePotion(){
  if(inventory.potions<=0)return;
  playSound("sndItem"); vibrate(40);
  inventory.potions--; energy=Math.min(energy+30,100);
  updateUI(); updateInventory();
}

// ===== RETIRO =====
function requestWithdraw(){
  if(!tonConnectUI.wallet)return alert("Conecta tu wallet");
  alert("Solicitud enviada\nTapCoin: "+tapCoin);
}

// ===== UI =====
const zone=document.getElementById("zone");
const inventoryDiv=document.getElementById("inventory");

function updateUI(){
  gold.innerText=gold;
  tapcoin.innerText=tapCoin;
  enemy.innerText=enemyHP;
  levelSpan.innerText=level;
  xpSpan.innerText=xp;
  energyBar.style.width=energy+"%";
  xpBar.style.width=Math.min((xp/(level*30))*100,100)+"%";
}
function updateInventory(){
  swords.innerText=inventory.swords;
  potions.innerText=inventory.potions;
}

// ===== IDLE =====
setInterval(()=>{if(energy<100){energy++;updateUI()}},5000);

// ===== TELEGRAM =====
if(window.Telegram){Telegram.WebApp.ready();Telegram.WebApp.expand()}
</script>

</body>
</html>  border-radius:18px;
  border:none;
  cursor:pointer;
  background:linear-gradient(180deg,#f5af19,#f12711);
  color:#000;
  font-weight:bold;
  box-shadow:0 4px 12px rgba(0,0,0,.6);
}
button:active { transform:scale(.95); }
button:disabled { background:#555;color:#aaa; }
.tap {
  font-size:24px;
  background:linear-gradient(180deg,#00f260,#0575e6);
  color:#fff;
}
.back {
  background:linear-gradient(180deg,#434343,#000);
  color:#fff;
}
.hidden { display:none; }

.bar {
  width:100%;
  height:16px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  margin-bottom:12px;
}
.fill {
  height:100%;
  transition:width .3s;
}
.energy { background:linear-gradient(90deg,#00ff87,#60efff); }
.xp { background:linear-gradient(90deg,#ff512f,#dd2476); }

.hit { animation:hit .15s; }
@keyframes hit {
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  100%{transform:translateX(0)}
}
@keyframes fadeIn {
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}
</style>
</head>

<body>

<h1>âš”ï¸ TapQuest</h1>

<!-- MAPA -->
<div class="card" id="map">
  <h2>ğŸ—ºï¸ Mapa del Mundo</h2>
  <p>ğŸ§¬ Nivel: <span id="level">1</span></p>
  <p>â­ XP: <span id="xp">0</span></p>

  <button onclick="enterZone(1)">ğŸŒ² Bosque Inicial</button>
  <button id="zone2" onclick="enterZone(2)" disabled>ğŸœï¸ Desierto (Nivel 3)</button>
  <button id="zone3" onclick="enterZone(3)" disabled>ğŸ”ï¸ MontaÃ±as (Nivel 5)</button>
</div>

<!-- ZONA -->
<div class="card hidden" id="zone">
  <h2 id="zoneName"></h2>

  <p>ğŸª™ Oro: <span id="gold">0</span></p>

  <p>ğŸ”‹ EnergÃ­a</p>
  <div class="bar"><div id="energyBar" class="fill energy"></div></div>

  <p>â­ XP</p>
  <div class="bar"><div id="xpBar" class="fill xp"></div></div>

  <p>ğŸ‘¹ Enemigo HP: <span id="enemy">0</span></p>

  <button class="tap" onclick="tap()">âš”ï¸ ATACAR</button>
  <button onclick="openInventory()">ğŸ’ Inventario</button>
  <button class="back" onclick="back()">â¬…ï¸ Volver</button>
</div>

<!-- INVENTARIO -->
<div class="card hidden" id="inventory">
  <h2>ğŸ’ Inventario</h2>

  <p>ğŸ—¡ï¸ Espadas: <span id="swords">0</span></p>
  <button onclick="useSword()">Usar espada</button>

  <p>ğŸ§ª Pociones: <span id="potions">0</span></p>
  <button onclick="usePotion()">Usar pociÃ³n</button>

  <button class="back" onclick="closeInventory()">â¬…ï¸ Volver</button>
</div>

<!-- SONIDOS -->
<audio id="sndHit" src="https://actions.google.com/sounds/v1/impacts/wood_plank_flicks.ogg"></audio>
<audio id="sndLevel" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="sndItem" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>

<script>
// ===== UTIL =====
function playSound(id){
  const s=document.getElementById(id);
  if(!s)return;
  s.currentTime=0;
  s.play();
}
function vibrate(ms=30){
  if(window.Telegram && Telegram.WebApp.HapticFeedback){
    Telegram.WebApp.HapticFeedback.impactOccurred("light");
  } else if(navigator.vibrate){
    navigator.vibrate(ms);
  }
}

// ===== ESTADO =====
let gold=0, energy=100, level=1, xp=0, damage=1;
let inventory={swords:0,potions:0};

const zones={
  1:{name:"ğŸŒ² Bosque Inicial",hp:5,xp:5,gold:2},
  2:{name:"ğŸœï¸ Desierto Antiguo",hp:10,xp:10,gold:4},
  3:{name:"ğŸ”ï¸ MontaÃ±as Heladas",hp:20,xp:20,gold:8}
};
let currentZone=1;
let enemyHP=zones[1].hp;

// ===== MAPA =====
function enterZone(z){
  currentZone=z;
  enemyHP=zones[z].hp;
  document.getElementById("map").classList.add("hidden");
  document.getElementById("zone").classList.remove("hidden");
  document.getElementById("zoneName").innerText=zones[z].name;
  updateUI();
}
function back(){
  document.getElementById("zone").classList.add("hidden");
  document.getElementById("map").classList.remove("hidden");
}

// ===== COMBATE =====
function tap(){
  if(energy<=0)return;

  playSound("sndHit");
  vibrate(20);

  document.getElementById("zone").classList.add("hit");
  setTimeout(()=>document.getElementById("zone").classList.remove("hit"),150);

  energy--;
  enemyHP-=damage;

  if(enemyHP<=0){
    enemyHP=zones[currentZone].hp;
    gold+=zones[currentZone].gold;
    xp+=zones[currentZone].xp;

    if(Math.random()<0.3)inventory.potions++;
    if(Math.random()<0.2)inventory.swords++;

    checkLevelUp();
  }
  updateUI();
}

// ===== NIVEL =====
function checkLevelUp(){
  let need=level*30;
  if(xp>=need){
    xp-=need;
    level++;
    playSound("sndLevel");
    vibrate(60);
    alert("ğŸ§¬ Subiste a nivel "+level);
    if(level>=3)document.getElementById("zone2").disabled=false;
    if(level>=5)document.getElementById("zone3").disabled=false;
  }
}

// ===== INVENTARIO =====
function openInventory(){
  document.getElementById("zone").classList.add("hidden");
  document.getElementById("inventory").classList.remove("hidden");
  updateInventory();
}
function closeInventory(){
  document.getElementById("inventory").classList.add("hidden");
  document.getElementById("zone").classList.remove("hidden");
}
function useSword(){
  if(inventory.swords<=0)return;
  playSound("sndItem");
  vibrate(40);
  inventory.swords--;
  damage++;
  updateInventory();
}
function usePotion(){
  if(inventory.potions<=0)return;
  playSound("sndItem");
  vibrate(40);
  inventory.potions--;
  energy=Math.min(energy+30,100);
  updateUI();
  updateInventory();
}

// ===== UI =====
function updateUI(){
  document.getElementById("gold").innerText=gold;
  document.getElementById("enemy").innerText=enemyHP;
  document.getElementById("level").innerText=level;
  document.getElementById("xp").innerText=xp;
  document.getElementById("energyBar").style.width=energy+"%";
  let need=level*30;
  document.getElementById("xpBar").style.width=Math.min((xp/need)*100,100)+"%";
}
function updateInventory(){
  document.getElementById("swords").innerText=inventory.swords;
  document.getElementById("potions").innerText=inventory.potions;
}

// ===== IDLE =====
setInterval(()=>{
  if(energy<100){
    energy++;
    updateUI();
  }
},5000);

// ===== TELEGRAM =====
if(window.Telegram){
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
}
</script>

</body>
</html>  border-radius:18px;
  border:none;
  cursor:pointer;
  background:linear-gradient(180deg,#f5af19,#f12711);
  color:#000;
  font-weight:bold;
  box-shadow:0 4px 12px rgba(0,0,0,.6);
}
button:active {
  transform:scale(.95);
}
button:disabled {
  background:#555;
  color:#aaa;
}
.tap {
  font-size:24px;
  background:linear-gradient(180deg,#00f260,#0575e6);
  color:#fff;
}
.back {
  background:linear-gradient(180deg,#434343,#000);
  color:#fff;
}
.hidden { display:none; }

.bar {
  width:100%;
  height:16px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  margin-bottom:12px;
}
.fill {
  height:100%;
  transition:width .3s;
}
.energy { background:linear-gradient(90deg,#00ff87,#60efff); }
.xp { background:linear-gradient(90deg,#ff512f,#dd2476); }

.hit { animation:hit .15s; }
@keyframes hit {
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  100%{transform:translateX(0)}
}
@keyframes fadeIn {
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}
</style>
</head>

<body>

<h1>âš”ï¸ TapQuest</h1>

<!-- MAPA -->
<div class="card" id="map">
  <h2>ğŸ—ºï¸ Mapa del Mundo</h2>
  <p>ğŸ§¬ Nivel: <span id="level">1</span></p>
  <p>â­ XP: <span id="xp">0</span></p>

  <button onclick="enterZone(1)">ğŸŒ² Bosque Inicial</button>
  <button id="zone2" onclick="enterZone(2)" disabled>ğŸœï¸ Desierto (Nivel 3)</button>
  <button id="zone3" onclick="enterZone(3)" disabled>ğŸ”ï¸ MontaÃ±as (Nivel 5)</button>
</div>

<!-- ZONA -->
<div class="card hidden" id="zone">
  <h2 id="zoneName"></h2>

  <p>ğŸª™ Oro: <span id="gold">0</span></p>

  <p>ğŸ”‹ EnergÃ­a</p>
  <div class="bar"><div id="energyBar" class="fill energy"></div></div>

  <p>â­ XP</p>
  <div class="bar"><div id="xpBar" class="fill xp"></div></div>

  <p>ğŸ‘¹ Enemigo HP: <span id="enemy">0</span></p>

  <button class="tap" onclick="tap()">âš”ï¸ ATACAR</button>
  <button onclick="openInventory()">ğŸ’ Inventario</button>
  <button class="back" onclick="back()">â¬…ï¸ Volver</button>
</div>

<!-- INVENTARIO -->
<div class="card hidden" id="inventory">
  <h2>ğŸ’ Inventario</h2>

  <p>ğŸ—¡ï¸ Espadas: <span id="swords">0</span></p>
  <button onclick="useSword()">Usar espada</button>

  <p>ğŸ§ª Pociones: <span id="potions">0</span></p>
  <button onclick="usePotion()">Usar pociÃ³n</button>

  <button class="back" onclick="closeInventory()">â¬…ï¸ Volver</button>
</div>

<script>
// ESTADO
let gold=0, energy=100, level=1, xp=0, damage=1;
let inventory={swords:0,potions:0};

const zones={
  1:{name:"ğŸŒ² Bosque Inicial",hp:5,xp:5,gold:2},
  2:{name:"ğŸœï¸ Desierto Antiguo",hp:10,xp:10,gold:4},
  3:{name:"ğŸ”ï¸ MontaÃ±as Heladas",hp:20,xp:20,gold:8}
};
let currentZone=1;
let enemyHP=zones[1].hp;

// MAPA
function enterZone(z){
  currentZone=z;
  enemyHP=zones[z].hp;
  document.getElementById("map").classList.add("hidden");
  document.getElementById("zone").classList.remove("hidden");
  document.getElementById("zoneName").innerText=zones[z].name;
  updateUI();
}
function back(){
  document.getElementById("zone").classList.add("hidden");
  document.getElementById("map").classList.remove("hidden");
}

// COMBATE
function tap(){
  if(energy<=0)return;
  document.getElementById("zone").classList.add("hit");
  setTimeout(()=>document.getElementById("zone").classList.remove("hit"),150);

  energy--;
  enemyHP-=damage;

  if(enemyHP<=0){
    enemyHP=zones[currentZone].hp;
    gold+=zones[currentZone].gold;
    xp+=zones[currentZone].xp;

    if(Math.random()<0.3)inventory.potions++;
    if(Math.random()<0.2)inventory.swords++;

    checkLevelUp();
  }
  updateUI();
}

// NIVEL
function checkLevelUp(){
  let need=level*30;
  if(xp>=need){
    xp-=need;
    level++;
    alert("ğŸ§¬ Subiste a nivel "+level);
    if(level>=3)document.getElementById("zone2").disabled=false;
    if(level>=5)document.getElementById("zone3").disabled=false;
  }
}

// INVENTARIO
function openInventory(){
  document.getElementById("zone").classList.add("hidden");
  document.getElementById("inventory").classList.remove("hidden");
  updateInventory();
}
function closeInventory(){
  document.getElementById("inventory").classList.add("hidden");
  document.getElementById("zone").classList.remove("hidden");
}
function useSword(){
  if(inventory.swords<=0)return;
  inventory.swords--;
  damage++;
  alert("ğŸ—¡ï¸ DaÃ±o aumentado");
  updateInventory();
}
function usePotion(){
  if(inventory.potions<=0)return;
  inventory.potions--;
  energy=Math.min(energy+30,100);
  updateUI();
  updateInventory();
}

// UI
function updateUI(){
  document.getElementById("gold").innerText=gold;
  document.getElementById("enemy").innerText=enemyHP;
  document.getElementById("level").innerText=level;
  document.getElementById("xp").innerText=xp;
  document.getElementById("energyBar").style.width=energy+"%";
  let need=level*30;
  document.getElementById("xpBar").style.width=Math.min((xp/need)*100,100)+"%";
}
function updateInventory(){
  document.getElementById("swords").innerText=inventory.swords;
  document.getElementById("potions").innerText=inventory.potions;
}

// IDLE
setInterval(()=>{
  if(energy<100){
    energy++;
    updateUI();
  }
},5000);

// TELEGRAM
if(window.Telegram){
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
}
</script>

</body>
</html>    margin: 10px auto;
    display: block;
    font-size: 18px;
    border-radius: 18px;
    border: none;
    cursor: pointer;
    background: linear-gradient(180deg,#f5af19,#f12711);
    color: #000;
    font-weight: bold;
    transition: transform .1s, box-shadow .1s;
    box-shadow: 0 4px 12px rgba(0,0,0,.6);
  }

  button:active {
    transform: scale(.95);
    box-shadow: 0 2px 6px rgba(0,0,0,.8);
  }

  button:disabled {
    background: #555;
    color: #aaa;
    box-shadow: none;
  }

  .tap {
    font-size: 24px;
    background: linear-gradient(180deg,#00f260,#0575e6);
    color: #fff;
  }

  .back {
    background: linear-gradient(180deg,#434343,#000);
    color: #fff;
  }

  .hidden { display: none; }

  /* BARRAS */
  .bar {
    width: 100%;
    height: 16px;
    background: #222;
    border-radius: 10px;
    overflow: hidden;
    margin: 6px 0 12px;
  }

  .fill {
    height: 100%;
    transition: width .3s;
  }

  .energy { background: linear-gradient(90deg,#00ff87,#60efff); }
  .xp { background: linear-gradient(90deg,#ff512f,#dd2476); }

  /* ANIMACIONES */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .hit {
    animation: hit .15s;
  }

  @keyframes hit {
    0% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    50% { transform: translateX(4px); }
    100% { transform: translateX(0); }
  }
</style>
</head>

<body>

<h1>âš”ï¸ TapQuest</h1>

<!-- MAPA -->
<div class="card" id="map">
  <h2>ğŸ—ºï¸ Mapa del Mundo</h2>
  <p>ğŸ§¬ Nivel: <span id="level">1</span> | â­ XP: <span id="xp">0</span></p>

  <button onclick="enterZone(1)">ğŸŒ² Bosque Inicial</button>
  <button id="zone2" onclick="enterZone(2)" disabled>ğŸœï¸ Desierto (Nivel 3)</button>
  <button id="zone3" onclick="enterZone(3)" disabled>ğŸ”ï¸ MontaÃ±as (Nivel 5)</button>
</div>

<!-- ZONA -->
<div class="card hidden" id="zone">
  <h2 id="zoneName"></h2>

  <p>ğŸª™ Oro: <span id="gold">0</span></p>
  <p>ğŸ”‹ EnergÃ­a</p>
<div class="bar">
  <div id="energyBar" class="fill energy"></div>
</div>

<p>â­ XP</p>
<div class="bar">
  <div id="xpBar" class="fill xp"></div>
</div>
  <p>â­ XP: <span id="xpZone">0</span></p>

  <p>ğŸ‘¹ Enemigo HP: <span id="enemy">0</span></p>

  <p id="missionText"></p>
  <p id="missionProgress"></p>

  <button class="tap" onclick="tap()">âš”ï¸ ATACAR</button>
  <button onclick="openInventory()">ğŸ’ Inventario</button>
  <button class="back" onclick="back()">â¬…ï¸ Volver</button>
</div>

<!-- INVENTARIO -->
<div class="card hidden" id="inventory">
  <h2>ğŸ’ Inventario</h2>

  <p>ğŸ—¡ï¸ Espadas: <span id="swords">0</span></p>
  <button onclick="useSword()">Usar espada</button>

  <p>ğŸ§ª Pociones: <span id="potions">0</span></p>
  <button onclick="usePotion()">Usar pociÃ³n</button>

  <button class="back" onclick="closeInventory()">â¬…ï¸ Volver</button>
</div>

<script>
/* ===== ESTADO ===== */
let gold = 0;
let energy = 100;
let level = 1;
let xp = 0;
let damage = 1;

/* INVENTARIO */
let inventory = { swords: 0, potions: 0 };

/* ZONAS */
const zones = {
  1: { name: "ğŸŒ² Bosque Inicial", hp: 5, xp: 5, gold: 2 },
  2: { name: "ğŸœï¸ Desierto Antiguo", hp: 10, xp: 10, gold: 4 },
  3: { name: "ğŸ”ï¸ MontaÃ±as Heladas", hp: 20, xp: 20, gold: 8 }
};

let currentZone = 1;
let enemyHP = zones[1].hp;

/* MISIÃ“N */
let mission = {
  goal: 3,
  progress: 0,
  completed: false
};

/* ===== MAPA ===== */
function enterZone(z) {
  currentZone = z;
  enemyHP = zones[z].hp;

  document.getElementById("map").classList.add("hidden");
  document.getElementById("zone").classList.remove("hidden");

  document.getElementById("zoneName").innerText = zones[z].name;
  updateUI();
}

function back() {
  document.getElementById("zone").classList.add("hidden");
  document.getElementById("map").classList.remove("hidden");
}

/* ===== COMBATE ===== */
function tap() {
  document.getElementById("zone").classList.add("hit");
setTimeout(() => {
  document.getElementById("zone").classList.remove("hit");
}, 150);
  if (energy <= 0) return;

  energy--;
  enemyHP -= damage;

  if (enemyHP <= 0) {
    enemyHP = zones[currentZone].hp;
    gold += zones[currentZone].gold;
    xp += zones[currentZone].xp;
    mission.progress++;

    if (Math.random() < 0.3) inventory.potions++;
    if (Math.random() < 0.2) inventory.swords++;

    checkLevelUp();
  }

  updateUI();
}

/* ===== NIVEL ===== */
function checkLevelUp() {
  let need = level * 30;
  if (xp >= need) {
    xp -= need;
    level++;
    alert("ğŸ§¬ Subiste a nivel " + level);

    if (level >= 3) document.getElementById("zone2").disabled = false;
    if (level >= 5) document.getElementById("zone3").disabled = false;
  }
}

/* ===== INVENTARIO ===== */
function openInventory() {
  document.getElementById("zone").classList.add("hidden");
  document.getElementById("inventory").classList.remove("hidden");
  updateInventory();
}
function closeInventory() {
  document.getElementById("inventory").classList.add("hidden");
  document.getElementById("zone").classList.remove("hidden");
}
function useSword() {
  if (inventory.swords <= 0) return;
  inventory.swords--;
  damage++;
  alert("ğŸ—¡ï¸ DaÃ±o aumentado");
  updateInventory();
}
function usePotion() {
  if (inventory.potions <= 0) return;
  inventory.potions--;
  energy = Math.min(energy + 30, 100);
  updateUI();
  updateInventory();
}

/* ===== UI ===== */
function updateUI() {
  document.getElementById("gold").innerText = gold;
  document.getElementById("energy").innerText = energy;
  document.getElementById("enemy").innerText = enemyHP;
  document.getElementById("xp").innerText = xp;
  document.getElementById("xpZone").innerText = xp;
  document.getElementById("level").innerText = level;
  document.getElementById("energyBar").style.width = energy + "%";

  let xpNeed = level * 30;
  document.getElementById("xpBar").style.width =
    Math.min((xp / xpNeed) * 100, 100) + "%";
}
function updateInventory() {
  document.getElementById("swords").innerText = inventory.swords;
  document.getElementById("potions").innerText = inventory.potions;
}

/* ===== IDLE ===== */
setInterval(() => {
  if (energy < 100) {
    energy++;
    updateUI();
  }
}, 5000);
</script>

</body>
</html>
