<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>TapQuest â€“ Reinos de TON</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial;
      background: linear-gradient(180deg,#0f2027,#203a43,#2c5364);
      color: white;
      text-align: center;
    }
    h1 { margin: 20px 0; }
    .card {
      background: rgba(0,0,0,.65);
      margin: 20px;
      padding: 20px;
      border-radius: 16px;
    }
    button {
      width: 90%;
      max-width: 320px;
      padding: 15px;
      margin: 10px auto;
      display: block;
      font-size: 18px;
      border-radius: 16px;
      border: none;
      cursor: pointer;
    }
    .tap {
      background: gold;
      color: black;
      font-size: 22px;
      font-weight: bold;
    }
    .back {
      background: #444;
      color: white;
    }
    .hidden {
      display: none;
    }
  </style>
</head>

<body>

<h1>âš”ï¸ TapQuest</h1>

<div class="card" id="map">
  <h2>ğŸ—ºï¸ Mapa del Mundo</h2>
  <button onclick="enterZone()">ğŸŒ² Bosque Inicial</button>
</div>

<div class="card hidden" id="zone">
  <h2>ğŸŒ² Bosque Inicial</h2>
  <p>ğŸª™ Oro: <span id="gold">0</span></p>
  <p>ğŸ”‹ EnergÃ­a: <span id="energy">100</span></p>
  <p>ğŸ‘¹ Enemigo HP: <span id="enemy">10</span></p>

  <button class="tap" onclick="tap()">âš”ï¸ ATACAR</button>
  <button onclick="openInventory()">ğŸ’ Inventario</button>

<div class="card hidden" id="inventory">
  <h2>ğŸ’ Inventario</h2>

  <p>ğŸ—¡ï¸ Espadas: <span id="swords">0</span></p>
  <button onclick="useSword()">Usar espada</button>

  <p>ğŸ§ª Pociones: <span id="potions">0</span></p>
  <button onclick="usePotion()">Usar pociÃ³n</button>

  <button class="back" onclick="closeInventory()">â¬…ï¸ Volver</button>
</div>
  <button class="back" onclick="back()">â¬…ï¸ Volver</button>
</div>

<script>
  // ESTADO DEL JUGADOR
  let gold = 0;
  let energy = 100;
  let enemyHP = 5;
  let damage = 1;

  // INVENTARIO
  let inventory = {
    swords: 0,
    potions: 0
  };

  // MISIÃ“N
  const mission = {
    title: "ğŸ§™â€â™‚ï¸ El anciano del Bosque",
    description: "Derrota 3 bestias corruptas",
    goal: 3,
    progress: 0,
    reward: 10,
    completed: false
  };

  // ENTRAR A ZONA
  function enterZone() {
    document.getElementById("map").classList.add("hidden");
    document.getElementById("zone").classList.remove("hidden");
    updateUI();
  }

  function back() {
    document.getElementById("zone").classList.add("hidden");
    document.getElementById("map").classList.remove("hidden");
  }

  // INVENTARIO
  function openInventory() {
    document.getElementById("zone").classList.add("hidden");
    document.getElementById("inventory").classList.remove("hidden");
    updateInventoryUI();
  }

  function closeInventory() {
    document.getElementById("inventory").classList.add("hidden");
    document.getElementById("zone").classList.remove("hidden");
  }

  function useSword() {
    if (inventory.swords <= 0) return alert("No tienes espadas");
    inventory.swords--;
    damage += 1;
    alert("ğŸ—¡ï¸ DaÃ±o aumentado");
    updateInventoryUI();
  }

  function usePotion() {
    if (inventory.potions <= 0) return alert("No tienes pociones");
    inventory.potions--;
    energy = Math.min(energy + 20, 100);
    alert("ğŸ§ª EnergÃ­a recuperada");
    updateUI();
    updateInventoryUI();
  }

  // COMBATE
  function tap() {
    if (energy <= 0) return;

    energy--;
    enemyHP -= damage;

    if (enemyHP <= 0) {
      enemyHP = 5;
      gold += 2;

      // drop aleatorio
      if (Math.random() < 0.3) inventory.potions++;
      if (Math.random() < 0.2) inventory.swords++;

      if (!mission.completed) {
        mission.progress++;
        checkMission();
      }
    }

    updateUI();
  }

  function checkMission() {
    if (mission.progress >= mission.goal) {
      mission.completed = true;
      gold += mission.reward;
      alert("ğŸ‰ MisiÃ³n completada +" + mission.reward + " oro");
    }
  }

  // UI
  function updateUI() {
    document.getElementById("gold").innerText = gold;
    document.getElementById("energy").innerText = energy;
    document.getElementById("enemy").innerText = enemyHP;

    document.getElementById("missionText").innerText =
      mission.completed
        ? "âœ… MisiÃ³n completada"
        : mission.title + ": " + mission.description;

    document.getElementById("missionProgress").innerText =
      "Progreso: " + mission.progress + " / " + mission.goal;
  }

  function updateInventoryUI() {
    document.getElementById("swords").innerText = inventory.swords;
    document.getElementById("potions").innerText = inventory.potions;
  }

  // ENERGÃA IDLE
  setInterval(() => {
    if (energy < 100) {
      energy++;
      updateUI();
    }
  }, 5000);
</script>
</body>
</html>
